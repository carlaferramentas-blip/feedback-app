<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FeedbackPrivado - Gestão Completa</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1a2e; --cream: #f0f4ff; --gold: #2563eb; --gold-light: #dbeafe;
    --muted: #6b6b7b; --card: #ffffff; --border: #e2e8f0;
    --green: #2d6a4f; --green-light: #d8f3dc; --red: #9b2226; --red-light: #fde8e8;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; background: #ffffff; color: var(--ink); min-height: 100vh; }
  h1, h2, h3 { font-family: 'Playfair Display', serif; }
  .screen { display: none; min-height: 100vh; }
  .screen.active { display: flex; flex-direction: column; }
  nav { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); background: #fff; position: sticky; top: 0; z-index: 100; }
  .nav-brand { font-size: 1.5rem; font-weight: 700; color: var(--gold); text-decoration: none; }
  .nav-links { display: flex; gap: 1.5rem; align-items: center; }
  .nav-link { text-decoration: none; color: var(--muted); font-weight: 500; cursor: pointer; }
  .nav-link.active { color: var(--gold); }
  .btn { padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 500; cursor: pointer; border: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: 0.2s; }
  .btn-primary { background: var(--gold); color: #fff; }
  .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--ink); }
  .btn-danger { background: var(--red-light); color: var(--red); }
  .container { max-width: 1000px; margin: 0 auto; padding: 2rem; width: 100%; }
  .student-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
  .student-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; position: relative; }
  .student-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.05); }
  .score-badge { padding: 0.4rem 0.8rem; border-radius: 20px; font-weight: 600; font-size: 0.85rem; }
  .score-high { background: var(--green-light); color: var(--green); }
  .form-card { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 2.5rem; max-width: 700px; margin: 0 auto; }
  .form-group { margin-bottom: 1.5rem; }
  label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
  input, textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; font-family: inherit; font-size: 1rem; }
  .criterion-item { display: grid; grid-template-columns: 1fr 100px; align-items: center; gap: 1rem; margin-bottom: 0.75rem; padding: 0.75rem; background: var(--cream); border-radius: 8px; }
  .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(26,26,46,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
  .modal-content { background: #fff; padding: 2.5rem; border-radius: 20px; max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto; }
  .feedback-html-container { line-height: 1.6; color: #333; background: #fff; padding: 1.5rem; border: 1px solid var(--border); border-radius: 12px; }
</style>
</head>
<body>

  <nav>
    <a href="#" class="nav-brand" onclick="showScreen('home')">FeedbackPrivado</a>
    <div class="nav-links">
      <span class="nav-link active" id="nav-home" onclick="showScreen('home')">Lista</span>
      <button class="btn btn-primary" onclick="openNewStudentForm()">+ Novo Formando</button>
    </div>
  </nav>

  <main id="screen-home" class="screen active">
    <div class="container">
      <div style="margin-bottom: 3rem; text-align: center;">
        <h1>Painel de Formandos</h1>
        <p>Dados persistentes via LocalStorage e Configuração Interna</p>
      </div>
      <div id="student-grid" class="student-grid"></div>
    </div>
  </main>

  <main id="screen-form" class="screen">
    <div class="container">
      <div class="form-card">
        <h2 id="form-title" style="margin-bottom: 2rem;">Editar Formando</h2>
        <form id="student-form">
          <input type="hidden" id="student-id">
          <div class="form-group"><label>Nome Completo</label><input type="text" id="student-name" required></div>
          <div class="form-group"><label>Password</label><input type="text" id="student-pass" required></div>
          <div class="form-group"><label>Feedback Detalhado (Aceita HTML)</label><textarea id="student-feedback" rows="12"></textarea></div>
          <div id="criteria-inputs"></div>
          <div style="margin-top: 2.5rem; display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-primary" style="flex: 2;">Guardar Alterações</button>
            <button type="button" class="btn btn-outline" style="flex: 1;" onclick="showScreen('home')">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <div id="feedback-modal" class="modal-overlay" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
      <h2 id="modal-student-name" style="margin-bottom: 1.5rem; color: var(--gold);"></h2>
      <div id="modal-feedback-content" class="feedback-html-container"></div>
      <div style="text-align: right; margin-top: 2rem;">
        <button class="btn btn-primary" onclick="document.getElementById('feedback-modal').style.display='none'">Fechar Janela</button>
      </div>
    </div>
  </div>

<script>
const criteriaNames = ["Domínio dos Conteúdos", "Participação/Assiduidade", "Trabalho em Equipa", "Qualidade Exercícios", "Autonomia", "Capacidade Análise", "Projeto Final"];

// DADOS EXTRAÍDOS DIRETAMENTE DO TEU FICHEIRO SEM CORTES
const internalDatabase = [
  {
    id: "1772211219943",
    name: "Helena Salomé",
    password: "Solar34",
    nota: "10.00",
    feedback: `<p>Olá, Helena Salomé,</p><p>O cenário apresentado é claro, coerente e cumpre a estrutura solicitada.</p><p><b>Pontos Fortes:</b> Enquadramento Claro e Escolha de Metodologia.</p><p><b>Interatividade:</b> A proposta coloca o aluno no centro da pesquisa.</p><p><b>Recomendação:</b> Foco no Prompt Engineering e Verificação de Factos.</p>`,
    criterios: [10,10,10,10,10,10,10]
  },
  {
    id: "1772214228833",
    name: "Hélia Gamito",
    password: "Azul85",
    nota: "10.00",
    feedback: `<p>Olá, Hélia Gamito,</p><p>Cenário extremamente sensível com excelente adaptação inclusiva.</p><p><b>Pontos Fortes:</b> Pertinência do Tema e Mediação Pedagógica.</p><p><b>Recomendação:</b> Explore o uso de IA para gerar imagens personalizadas.</p>`,
    criterios: [10,10,10,10,10,10,10]
  },
  {
    id: "1772216551949",
    name: "José Delgado",
    password: "Rio51",
    nota: "10.00",
    feedback: `<p>Olá, José Delgado,</p><p>O cenário 'Visual Poetry' apresenta uma excelente articulação curricular.</p><p><b>Destaque:</b> Proposta inovadora de transformar palavras em imagens com IA.</p>`,
    criterios: [10,10,10,10,10,10,10]
  },
  {
    id: "1772216954201",
    name: "Maria Antónia",
    password: "Verde22",
    nota: "10.00",
    feedback: `<p>Excelente proposta focada na exploração de prompts e análise crítica de resultados gerados por IA.</p>`,
    criterios: [10,10,10,10,10,10,10]
  },
  {
    id: "1772217594541",
    name: "Paula Cristina",
    password: "Mar99",
    nota: "10.00",
    feedback: `<p>Trabalho muito bem estruturado, com foco na diferenciação pedagógica e no uso ético da IA.</p>`,
    criterios: [10,10,10,10,10,10,10]
  },
  {
    id: "1772218151322",
    name: "Ricardo Jorge",
    password: "Terra10",
    nota: "10.00",
    feedback: `<p>Ótima integração de ferramentas de IA para apoio ao estudo e criação de materiais didáticos dinâmicos.</p>`,
    criterios: [10,10,10,10,10,10,10]
  },
  {
    id: "1772223
