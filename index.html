<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feedback Privado</title>

<style>
body { font-family: Arial; margin:0; display:flex; height:100vh; }
.sidebar { width:260px; border-right:1px solid #ccc; padding:20px; }
.main { flex:1; padding:20px; }
.student { padding:8px; cursor:pointer; border-radius:6px; }
.student:hover { background:#f0f0f0; }
textarea { width:100%; height:200px; margin-top:10px; }
button { padding:8px 14px; margin-top:10px; cursor:pointer; }
input { width:100%; padding:8px; margin-top:5px; }
</style>

</head>
<body>

<div class="sidebar">
  <h3>Formandos</h3>
  <div id="studentList"></div>

  <h4>Adicionar Formando</h4>
  <input id="nameInput" placeholder="Nome">
  <input id="passInput" placeholder="Password">
  <button onclick="addStudent()">Adicionar</button>
</div>

<div class="main">
  <h2 id="studentName">Seleciona um formando</h2>
  <textarea id="feedbackBox" placeholder="Escreve o feedback aqui..."></textarea>
  <br>
  <button onclick="saveFeedback()">Guardar Feedback</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCwEo1iHIpqr5lYK74-7y8cXieQq5fX7As",
  authDomain: "feedback-formandos.firebaseapp.com",
  projectId: "feedback-formandos",
  storageBucket: "feedback-formandos.firebasestorage.app",
  messagingSenderId: "885812115335",
  appId: "1:885812115335:web:3d992b8dd30900bdd24522"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let selectedId = null;

async function loadStudents(){
  const list = document.getElementById("studentList");
  list.innerHTML = "";

  const querySnapshot = await getDocs(collection(db,"students"));

  querySnapshot.forEach((docSnap)=>{
    const data = docSnap.data();

    const div = document.createElement("div");
    div.className = "student";
    div.textContent = data.name;

    div.onclick = ()=>{
      selectedId = docSnap.id;
      document.getElementById("studentName").textContent = data.name;
      document.getElementById("feedbackBox").value = data.feedback || "";
    };

    list.appendChild(div);
  });
}

window.addStudent = async function(){
  const name = document.getElementById("nameInput").value;
  const password = document.getElementById("passInput").value;

  if(!name || !password){
    alert("Preenche nome e password");
    return;
  }

  await addDoc(collection(db,"students"),{
    name: name,
    password: password,
    feedback: ""
  });

  document.getElementById("nameInput").value="";
  document.getElementById("passInput").value="";
  loadStudents();
}

window.saveFeedback = async function(){
  if(!selectedId){
    alert("Seleciona um formando");
    return;
  }

  const text = document.getElementById("feedbackBox").value;

  await updateDoc(doc(db,"students",selectedId),{
    feedback: text
  });

  alert("Feedback guardado!");
}

loadStudents();

</script>

</body>
</html>
