
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FeedbackPrivado - Firestore</title>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; margin:0; display:flex; height:100vh; }
.sidebar { width:300px; border-right:1px solid #ddd; padding:20px; box-sizing:border-box; }
.main { flex:1; padding:40px; }
button { padding:8px 12px; margin-top:10px; }
.student { cursor:pointer; padding:6px; border-bottom:1px solid #eee; }
.student:hover { background:#f5f5f5; }
textarea { width:100%; height:300px; }
</style>
</head>

<body>

<div class="sidebar">
<h3>Formandos</h3>
<div id="studentList"></div>

<h4>Adicionar Formando</h4>
<input type="text" id="newName" placeholder="Nome"><br>
<input type="text" id="newPass" placeholder="Password"><br>
<button onclick="addStudent()">Adicionar</button>
</div>

<div class="main">
<h2 id="selectedName">Seleciona um formando</h2>
<textarea id="feedbackBox" placeholder="Escreve feedback aqui..."></textarea><br>
<button onclick="saveFeedback()">Guardar Feedback</button>
</div>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCwEo1iHIpqr5lYK74-7y8cXieQq5fX7As",
  authDomain: "feedback-formandos.firebaseapp.com",
  projectId: "feedback-formandos",
  storageBucket: "feedback-formandos.firebasestorage.app",
  messagingSenderId: "885812115335",
  appId: "1:885812115335:web:3d992b8dd30900bdd24522"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selectedId = null;

// ðŸ”¥ Carregar alunos em tempo real
db.collection("students").onSnapshot(snapshot => {
  const list = document.getElementById("studentList");
  list.innerHTML = "";

  snapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement("div");
    div.className = "student";
    div.innerText = data.name || doc.id;
    div.onclick = () => selectStudent(doc.id, data);
    list.appendChild(div);
  });
});

function selectStudent(id, data){
  selectedId = id;
  document.getElementById("selectedName").innerText = data.name;
  document.getElementById("feedbackBox").value = data.feedback || "";
}

function addStudent(){
  const name = document.getElementById("newName").value;
  const pass = document.getElementById("newPass").value;

  if(!name || !pass){
    alert("Preenche nome e password");
    return;
  }

  db.collection("students").add({
    name: name,
    password: pass,
    feedback: ""
  });

  document.getElementById("newName").value = "";
  document.getElementById("newPass").value = "";
}

function saveFeedback(){
  if(!selectedId){
    alert("Seleciona um formando primeiro");
    return;
  }

  const feedback = document.getElementById("feedbackBox").value;

  db.collection("students").doc(selectedId).update({
    feedback: feedback
  });

  alert("Feedback guardado!");
}

</script>

</body>
</html>
